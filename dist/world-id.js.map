{"version":3,"file":"world-id.js","sources":["../src/utils/keccak-256.ts","../src/utils/hash-bytes.ts","../src/utils/random-number.ts","../src/utils/build-verification-request.ts","../src/utils/validate-abi-like-encoding.ts","../src/utils/validate-input-params.ts","../src/utils/verify-verification-response.ts","../src/components/SayHello.tsx","../src/components/ReactWIdget.tsx","../src/widget/init.tsx","../src/index.ts"],"sourcesContent":["import sha3 from \"js-sha3\";\nimport { arrayify, concat, hexlify } from \"@ethersproject/bytes\";\n\n/**\n * Partial implementation of `keccak256` hash from @ethersproject/solidity; only supports hashing a single BytesLike value\n * @param value value to hash\n * @returns\n */\nexport function keccak256(value: Buffer): string {\n  const tight: Array<Uint8Array> = [arrayify(value)];\n  const data = hexlify(concat(tight));\n  return \"0x\" + sha3.keccak_256(arrayify(data));\n}\n","import { keccak256 } from \"./keccak-256\";\n\n/**\n * Hashes an input using the `keccak256` hashing function used across the World ID protocol, to be used as\n * a ZKP input.\n * @param input - Input to hash (if it's a string, it'll be converted to bytes first)\n * @returns hash\n */\nexport function hashBytes(input: string | Buffer): {\n  hash: BigInt;\n  digest: string;\n} {\n  const bytesInput = Buffer.isBuffer(input) ? input : Buffer.from(input);\n  const hash = BigInt(keccak256(bytesInput)) >> BigInt(8);\n  const rawDigest = hash.toString(16);\n  return { hash, digest: `0x${rawDigest.padStart(64, \"0\")}` };\n}\n","/**\n * Generates a random integer between a specified range\n * @param min Minimum number in range (inclusive)\n * @param max Maximum number in range (inclusive)\n * @returns Number between range\n */\nexport const randomNumber = (min: number, max: number): number => {\n  return Math.floor(Math.random() * (max - min + 1) + min);\n};\n","import {\n  AppProps,\n  VerificationRequest,\n  VerificationRequestParams,\n} from \"../types\";\nimport { hashBytes } from \"./hash-bytes\";\nimport { randomNumber } from \"./random-number\";\n\nexport const buildVerificationRequest = (\n  props: AppProps\n): VerificationRequest => {\n  if (!props.signal) {\n    throw new Error(\n      \"Unexpectedly trying to build verification request without a `signal`.\"\n    );\n  }\n\n  const params: VerificationRequestParams = {\n    signal: props.advanced_use_raw_signal\n      ? props.signal\n      : hashBytes(props.signal).digest,\n    action_id: props.advanced_use_raw_action_id\n      ? props.action_id\n      : hashBytes(props.action_id).digest,\n  };\n\n  if (props.app_name) {\n    params.app_name = props.app_name;\n  }\n\n  if (props.signal_description) {\n    params.signal_description = props.signal_description;\n  }\n\n  return {\n    id: randomNumber(100000, 9999999),\n    jsonrpc: \"2.0\",\n    method: \"wld_worldIDVerification\",\n    params: [params],\n  };\n};\n","/**\n * Validates that an string looks like an ABI-encoded string. Very basic format-like check.\n * The WLD app validates the actual values.\n * @param value string to validate\n * @returns `true` if the value looks like an ABI-encoded string; `false` otherwise\n */\nexport const validateABILikeEncoding = (value: string): boolean => {\n  const ABI_REGEX = /^0x[\\dabcdef]+$/;\n  return !!value.toString().match(ABI_REGEX) && value.length >= 66; // Because `0` contains 66 characters\n};\n","import { AppProps } from \"../types\";\nimport { validateABILikeEncoding } from \"./validate-abi-like-encoding\";\n\n/**\n * Validates the input parameters passed to the package when initializing.\n * @param params `AppProps`\n * @returns `true` if parameters are valid; error is raised otherwise.\n */\nexport const validateInputParams = (\n  params: AppProps\n): { valid: boolean; error?: string } => {\n  if (!params.action_id) {\n    return {\n      valid: false,\n      error: \"The `action_id` parameter is always required.\",\n    };\n  }\n\n  if (\n    params.advanced_use_raw_action_id &&\n    !validateABILikeEncoding(params.action_id)\n  ) {\n    return {\n      valid: false,\n      error: `You enabled 'advanced_use_raw_action_id' which uses the action ID raw (without any additional hashing or encoding),\n        but the action ID you provided does not look to be validly hashed or encoded. Please check\n        https://id.worldcoin.org/docs/js/reference#parameters for details.`,\n    };\n  }\n\n  if (\n    params.advanced_use_raw_signal &&\n    params.signal &&\n    !validateABILikeEncoding(params.signal)\n  ) {\n    return {\n      valid: false,\n      error: `You enabled 'advanced_use_raw_signal' which uses the signal raw (without any additional hashing or encoding),\n        but the signal you provided does not look to be validly hashed or encoded. Please check\n        https://id.worldcoin.org/docs/js/reference#parameters for details.`,\n    };\n  }\n\n  return { valid: true };\n};\n","import { validateABILikeEncoding } from \"./validate-abi-like-encoding\";\n\n/**\n * Verifies that the response from the WLD app is valid\n * @param result expects a valid `VerificationResponse`\n */\nexport const verifyVerificationResponse = (\n  result: Record<string, string | undefined>\n): boolean => {\n  const merkle_root = \"merkle_root\" in result ? result.merkle_root : undefined;\n  const nullifier_hash =\n    \"nullifier_hash\" in result ? result.nullifier_hash : undefined;\n  const proof = \"proof\" in result ? result.proof : undefined;\n\n  for (const attr of [merkle_root, nullifier_hash, proof]) {\n    if (!attr || !validateABILikeEncoding(attr)) {\n      return false;\n    }\n  }\n\n  return true;\n};\n","import { useEffect, useState } from \"react\";\n\nexport function SayHello(props: { name: string }): JSX.Element {\n  const [name, setName] = useState(props.name);\n\n  useEffect(() => {\n    setName(props.name);\n  }, [props]);\n\n  return <div>Hey {name}, say hello to TypeScript.</div>;\n}\n","export const ReactWidget = (): JSX.Element => {\n  return <div>I am React Widget</div>;\n};\n","import { render } from \"react-dom\";\nimport { ReactWidget } from \"components\";\n\nexport const init = (elementInput: string | HTMLElement) => {\n  let mountNode: HTMLElement | null = null;\n\n  if (typeof elementInput !== \"string\") {\n    mountNode = elementInput;\n  }\n\n  if (typeof elementInput === \"string\") {\n    mountNode = document.getElementById(elementInput);\n  }\n\n  if (mountNode !== null) {\n    render(<ReactWidget />, mountNode);\n  }\n};\n","import {\n  buildVerificationRequest,\n  hashBytes,\n  keccak256,\n  randomNumber,\n  validateABILikeEncoding,\n  validateInputParams,\n  verifyVerificationResponse,\n} from \"./utils\";\n\nimport { init } from \"./widget\";\n\nexport * from \"./components\";\n\nexport const utils = {\n  buildVerificationRequest,\n  hashBytes,\n  keccak256,\n  randomNumber,\n  validateABILikeEncoding,\n  validateInputParams,\n  verifyVerificationResponse,\n};\n\nexport default { init };\n"],"names":["arrayify","hexlify","concat","sha3","useState","useEffect","_jsxs","_jsx","render"],"mappings":"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"}